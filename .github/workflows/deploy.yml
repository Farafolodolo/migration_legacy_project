name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '10.0.x'
      
      - name: Build
        run: dotnet build
      
      - name: Generate appsettings.json for Production
        run: |
          cat > appsettings.json <<EOF
          {
            "Logging": { "LogLevel": { "Default": "Information" } },
            "ConnectionStrings": {
              "DefaultConnection": "Host=${{ secrets.DB_HOST }};Port=${{ secrets.DB_PORT }};Database=${{ secrets.DB_NAME }};Username=${{ secrets.DB_USER }};Password=${{ secrets.DB_PASSWORD }};Pooling=true"
            }
          }
          EOF
      
      - name: Deploy
        run: dotnet publish -c Release
